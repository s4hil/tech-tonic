<!DOCTYPE html>
<html>
<head>
    <title>Admin - Tech Tonic</title>
</head>
<body>
    <div class="flex justify-content-center m-5">
        <h2 class="alert alert-info text-center">Submissions</h2>
        <table class="table table-striped mt-2" id="table">
            <thead>
                <tr class="bg-dark text-white">
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>College</th>
                    <th class="hidden">Member 1</th>
                    <th class="hidden">Member 2</th>
                    <th class="hidden">Member 3</th>
                    <th class="hidden">Member 4</th>
                    <th class="hidden">TXN ID</th>
                    <th class="hidden">Time Stamp</th>
                    <th>Event</th>
                    <th>Domain</th>
                    <th>Payment</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="table-body">
                
            </tbody>
        </table>
    </div>
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../js/jquery.table2excel.min.js"></script>
    <script src="../js/config.js"></script>
    <script>
        
        $(document).ready(()=>{

            let key = prompt("Enter Key");

                let output = "";

                $.ajax({
                    url: GET_SUBMISSIONS_URL,
                    method: "POST",
                    data: JSON.stringify({key: key}),
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        let x = data.submissions;
                        if (data.status == false) {
                            alert(data.msg);
                        }
                        else{
                            for(let i = 0; i < x.length; i++){
                                output += `
                                        <tr>
                                            <td>${x[i].id}</td>
                                            <td>${x[i].team_name}</td>
                                            <td>${x[i].email}</td>
                                            <td>${x[i].college_name}</td>
                                            <td>(${x[i].member1})</td>
                                            <td>(${x[i].member2})</td>
                                            <td>(${x[i].member3})</td>
                                            <td>(${x[i].member4})</td>
                                            <td>${x[i].txn_id}</td>
                                            <td>${x[i].timestamp}</td>
                                            <td>${x[i].event}</td>
                                            <td>${x[i].domain}</td>
                                            <td>
                                                <a target='_blank' class='btn btn-warning' href="`+ UPLOAD_DIR +`${x[i].payment_sc}">View</a>
                                            </td>
                                            <td>
                                                <button class='del-sub btn btn-danger' email-id="${x[i].email}">Delete</button>
                                            </td>
                                        </tr>
                                    `;
                            }
                            $("#table-body").html(output);
                            $("#table").table2excel({
                                name: "Submissions",
                                filename: new Date()+" submissions.xls",
                                preserveColors: false
                            });
                        }
                    },
                    error: function () {
                        console.log("req err");
                    }
                })

        });

    </script>
</body>
</html>